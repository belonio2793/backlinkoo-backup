<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Loading Blog Post... | Backlinkoo</title>
    <meta id="page-description" name="description" content="Loading blog post...">
    <meta id="page-keywords" name="keywords" content="">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Loading Blog Post... | Backlinkoo" id="og-title">
    <meta property="og:description" content="Loading blog post..." id="og-description">
    <meta property="og:image" content="" id="og-image">
    <meta property="og:url" content="" id="og-url">
    <meta property="og:type" content="article">
    <meta property="og:site_name" content="Backlinkoo">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Loading Blog Post... | Backlinkoo" id="twitter-title">
    <meta name="twitter:description" content="Loading blog post..." id="twitter-description">
    <meta name="twitter:image" content="" id="twitter-image">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="" id="canonical-url">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom styles -->
    <style>
        .blog-content h1, .blog-content h2, .blog-content h3, .blog-content h4, .blog-content h5, .blog-content h6 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        .blog-content h1 { font-size: 2.5rem; line-height: 1.2; }
        .blog-content h2 { font-size: 2rem; line-height: 1.3; }
        .blog-content h3 { font-size: 1.5rem; line-height: 1.4; }
        .blog-content p { margin-bottom: 1rem; line-height: 1.7; }
        .blog-content ul, .blog-content ol { margin-bottom: 1rem; padding-left: 2rem; }
        .blog-content li { margin-bottom: 0.5rem; }
        .blog-content a { color: #2563eb; text-decoration: underline; }
        .blog-content a:hover { color: #1d4ed8; }
        .blog-content strong { font-weight: 600; }
        .blog-content blockquote { 
            border-left: 4px solid #e5e7eb; 
            padding-left: 1rem; 
            margin: 1.5rem 0; 
            font-style: italic; 
            color: #6b7280;
        }
        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="/" class="text-2xl font-bold text-blue-600">Backlinkoo</a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/" class="text-gray-600 hover:text-gray-900">Home</a>
                    <a href="/blog" class="text-gray-600 hover:text-gray-900">Blog</a>
                    <a href="/dashboard" class="text-gray-600 hover:text-gray-900">Dashboard</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Loading State -->
        <div id="loading-state" class="space-y-6">
            <div class="loading-skeleton h-12 rounded w-3/4"></div>
            <div class="flex items-center space-x-4">
                <div class="loading-skeleton h-10 w-10 rounded-full"></div>
                <div class="space-y-2">
                    <div class="loading-skeleton h-4 w-32 rounded"></div>
                    <div class="loading-skeleton h-3 w-24 rounded"></div>
                </div>
            </div>
            <div class="loading-skeleton h-64 rounded"></div>
            <div class="space-y-4">
                <div class="loading-skeleton h-4 rounded"></div>
                <div class="loading-skeleton h-4 rounded w-5/6"></div>
                <div class="loading-skeleton h-4 rounded w-4/5"></div>
            </div>
        </div>

        <!-- Error State -->
        <div id="error-state" class="text-center py-16 hidden">
            <div class="max-w-md mx-auto">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <h2 class="mt-4 text-lg font-medium text-gray-900">Blog Post Not Found</h2>
                <p class="mt-2 text-sm text-gray-500">The blog post you're looking for doesn't exist or may have been removed.</p>
                <div class="mt-6">
                    <a href="/" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                        Return to Homepage
                    </a>
                </div>
            </div>
        </div>

        <!-- Blog Content -->
        <article id="blog-content" class="hidden">
            <!-- Blog Header -->
            <header class="mb-8">
                <h1 id="blog-title" class="text-4xl font-bold text-gray-900 mb-4"></h1>
                
                <!-- Blog Meta -->
                <div class="flex items-center space-x-6 text-sm text-gray-500 mb-6">
                    <div class="flex items-center">
                        <img id="author-avatar" src="/placeholder.svg" alt="Author" class="h-8 w-8 rounded-full mr-2">
                        <span id="author-name">Backlinkoo Team</span>
                    </div>
                    <div id="publish-date"></div>
                    <div id="reading-time"></div>
                    <div id="view-count"></div>
                </div>
                
                <!-- Tags -->
                <div id="blog-tags" class="flex flex-wrap gap-2 mb-6"></div>
                
                <!-- Featured Image -->
                <div id="featured-image-container" class="mb-8 hidden">
                    <img id="featured-image" src="" alt="" class="w-full h-64 object-cover rounded-lg">
                </div>
            </header>

            <!-- Blog Body -->
            <div id="blog-body" class="blog-content prose prose-lg max-w-none"></div>

            <!-- Blog Footer -->
            <footer class="mt-12 pt-8 border-t border-gray-200">
                <div class="bg-blue-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-blue-900 mb-2">Want More High-Quality Backlinks?</h3>
                    <p class="text-blue-800 mb-4">Generate professional blog posts with natural backlinks to boost your SEO rankings.</p>
                    <a href="/" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                        Create Your Free Backlink
                        <svg class="ml-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                        </svg>
                    </a>
                </div>
            </footer>
        </article>
    </main>

    <!-- Scripts -->
    <script>
        // Get slug from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const slug = urlParams.get('slug') || window.location.pathname.split('/blog/')[1]?.split('/')[0];
        
        if (!slug) {
            showError();
        } else {
            loadBlogPost(slug);
        }

        async function loadBlogPost(slug) {
            try {
                // Initialize Supabase client
                const SUPABASE_URL = 'https://dfhanacsmsvvkpunurnp.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRmaGFuYWNzbXN2dmtwdW51cm5wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc3MDQxMjIsImV4cCI6MjA1MzI4MDEyMn0.Fj4zzWzQIxZ-2Ps-FHk6KeqPjSMwP1gJwqGj_d5K5GM';
                
                // Fetch blog post from Supabase
                const response = await fetch(`${SUPABASE_URL}/rest/v1/published_blog_posts?slug=eq.${slug}&status=eq.published&select=*`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                const blogPost = data[0];

                if (!blogPost) {
                    throw new Error('Blog post not found');
                }

                // Check if trial post has expired
                if (blogPost.is_trial_post && blogPost.expires_at) {
                    const now = new Date();
                    const expiresAt = new Date(blogPost.expires_at);
                    if (now > expiresAt) {
                        throw new Error('Blog post has expired');
                    }
                }

                // Increment view count
                try {
                    await fetch(`${SUPABASE_URL}/rest/v1/rpc/increment_blog_post_views`, {
                        method: 'POST',
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ post_slug: slug })
                    });
                } catch (viewError) {
                    console.warn('Failed to increment view count:', viewError);
                }

                // Render blog post
                renderBlogPost(blogPost);

            } catch (error) {
                console.error('Error loading blog post:', error);
                showError();
            }
        }

        function renderBlogPost(post) {
            // Update page metadata
            updatePageMetadata(post);

            // Populate blog content
            document.getElementById('blog-title').textContent = post.title;
            document.getElementById('author-name').textContent = post.author_name || 'Backlinkoo Team';
            document.getElementById('author-avatar').src = post.author_avatar || '/placeholder.svg';
            
            // Format publish date
            const publishDate = new Date(post.published_at).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('publish-date').textContent = publishDate;
            
            // Reading time
            document.getElementById('reading-time').textContent = `${post.reading_time || 5} min read`;
            
            // View count
            document.getElementById('view-count').textContent = `${post.view_count || 0} views`;

            // Tags
            const tagsContainer = document.getElementById('blog-tags');
            if (post.tags && post.tags.length > 0) {
                post.tags.forEach(tag => {
                    const tagElement = document.createElement('span');
                    tagElement.className = 'inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full';
                    tagElement.textContent = tag;
                    tagsContainer.appendChild(tagElement);
                });
            }

            // Featured image
            if (post.featured_image) {
                document.getElementById('featured-image').src = post.featured_image;
                document.getElementById('featured-image').alt = post.title;
                document.getElementById('featured-image-container').classList.remove('hidden');
            }

            // Blog content
            document.getElementById('blog-body').innerHTML = post.content;

            // Show content and hide loading
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('blog-content').classList.remove('hidden');
        }

        function updatePageMetadata(post) {
            // Update title
            document.title = `${post.title} | Backlinkoo`;
            document.getElementById('page-title').content = `${post.title} | Backlinkoo`;

            // Update description
            const description = post.meta_description || post.excerpt || `Read about ${post.title} on Backlinkoo`;
            document.getElementById('page-description').content = description;

            // Update keywords
            if (post.keywords && post.keywords.length > 0) {
                document.getElementById('page-keywords').content = post.keywords.join(', ');
            }

            // Update Open Graph tags
            document.getElementById('og-title').content = `${post.title} | Backlinkoo`;
            document.getElementById('og-description').content = description;
            document.getElementById('og-url').content = window.location.href;
            
            if (post.featured_image) {
                document.getElementById('og-image').content = post.featured_image;
            }

            // Update Twitter Card tags
            document.getElementById('twitter-title').content = `${post.title} | Backlinkoo`;
            document.getElementById('twitter-description').content = description;
            
            if (post.featured_image) {
                document.getElementById('twitter-image').content = post.featured_image;
            }

            // Update canonical URL
            document.getElementById('canonical-url').href = window.location.href;
        }

        function showError() {
            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('error-state').classList.remove('hidden');
        }
    </script>
</body>
</html>
